<div class="document-container">
    <div class="page-header">
        <h2>Web / Documents</h2>
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#uploadDocumentModal">
            <i class="bi bi-upload"></i> Importer un document
        </button>
    </div>

    <div class="filters-container">
        <form [formGroup]="filterForm" class="row g-3">
            <div class="col-md-4">
                <label for="idFilter" class="form-label">ID du fichier</label>
                <input type="text" id="idFilter" formControlName="idFilter" class="form-control"
                    placeholder="Saisissez l'ID ou le nom du fichier">
            </div>
            <div class="col-md-4">
                <label for="keywordsFilter" class="form-label">Mots-clés</label>
                <div class="dropdown">
                    <input type="text" id="keywordsFilter" formControlName="keywordsFilter" class="form-control"
                        placeholder="Sélectionnez / saisissez des tags">
                </div>
            </div>
            <div class="col-md-3">
                <label for="statusFilter" class="form-label">Statut</label>
                <select id="statusFilter" formControlName="statusFilter" class="form-select">
                    <option value="">Tous les statuts</option>
                    <option value="ACTIVE">Actif</option>
                    <option value="ARCHIVED">Archivé</option>
                    <option value="DRAFT">Brouillon</option>
                    <option value="PENDING_APPROVAL">En attente de validation</option>
                    <option value="REJECTED">Rejeté</option>
                </select>
            </div>
            <div class="col-md-1 d-flex align-items-end">
                <button type="button" class="btn btn-outline-primary btn-search" (click)="applyFilters()">
                    <i class="bi bi-search"></i>
                </button>
            </div>
        </form>
    </div>

    <div class="documents-header">
        <h3>Documents</h3>
        <div class="view-options">
            <button [class.active]="viewMode === 'list'" (click)="changeViewMode('list')"
                class="btn btn-sm btn-outline-secondary">
                <i class="bi bi-list"></i>
            </button>
            <button [class.active]="viewMode === 'grid'" (click)="changeViewMode('grid')"
                class="btn btn-sm btn-outline-secondary">
                <i class="bi bi-grid-3x3-gap"></i>
            </button>
        </div>
    </div>

    <div *ngIf="isUploading" class="upload-progress">
        <div class="progress">
            <div class="progress-bar" role="progressbar" [style.width.%]="uploadProgress"
                [attr.aria-valuenow]="uploadProgress" aria-valuemin="0" aria-valuemax="100">{{uploadProgress}}%</div>
        </div>
    </div>

    <div class="documents-container" [ngClass]="{'grid-view': viewMode === 'grid', 'list-view': viewMode === 'list'}">
        <div *ngIf="filteredDocuments.length === 0" class="no-documents">
            <p>Aucun document trouvé.</p>
        </div>

        <div *ngFor="let document of filteredDocuments" class="document-card">
            <div class="card-selection">
                <input type="checkbox" class="form-check-input" id="check-{{document.id}}">
            </div>

            <div class="document-icon" [ngClass]="document.fileType">
                <!-- Icône adaptée au type de document -->
                <span *ngIf="document.fileType === 'pdf'" class="file-icon">PDF</span>
                <span *ngIf="document.fileType === 'docx'" class="file-icon">DOC</span>
                <span *ngIf="document.fileType === 'xlsx'" class="file-icon">XLS</span>
                <span *ngIf="document.fileType === 'pptx'" class="file-icon">PPT</span>
                <span *ngIf="!['pdf', 'docx', 'xlsx', 'pptx'].includes(document.fileType)" class="file-icon">DOC</span>
            </div>

            <div class="document-info">
                <h4 class="document-title">{{document.title}}</h4>
                <div class="document-details">
                    <span class="document-type">{{document.fileType}} - {{document.fileSize | fileSize}}</span>
                    <span class="document-date">{{document.updatedAt | date:'dd/MM/yyyy'}}</span>
                </div>
            </div>

            <div class="document-status">
                <span class="badge" [ngClass]="{
        'bg-success': document.status === 'ACTIVE',
        'bg-secondary': document.status === 'ARCHIVED',
        'bg-info': document.status === 'DRAFT',
        'bg-warning': document.status === 'PENDING_APPROVAL',
        'bg-danger': document.status === 'REJECTED'
      }">
                    {{document.status | statusLabel}}
                </span>
            </div>

<!-- Actions dynamiques selon le statut -->
<div class="document-actions">
  <!-- Visible pour tous les statuts -->
  <button class="btn btn-sm btn-outline-primary" (click)="downloadDocument(document)" title="Télécharger" *ngIf="document.status !== 'DRAFT'">
    <i class="bi bi-download"></i>
  </button>
  
  <!-- Visible uniquement pour les brouillons ou en attente de validation -->
  <button class="btn btn-sm btn-outline-success" (click)="submitForApproval(document)" 
          *ngIf="document.status === 'DRAFT'" title="Soumettre pour validation">
    <i class="bi bi-check-circle"></i>
  </button>
  
  <!-- Visible uniquement pour les brouillons, rejetés ou en attente -->
<button class="btn btn-sm btn-outline-info" (click)="editDocument(document)" 
        *ngIf="isEditableStatus(document.status)" title="Modifier">
  <i class="bi bi-pencil"></i>
</button>
  
  <!-- Visible uniquement pour les documents en attente (pour les administrateurs) -->
  <button class="btn btn-sm btn-outline-success" (click)="approveDocument(document)" 
          *ngIf="document.status === 'PENDING_APPROVAL' && isAdmin" title="Approuver">
    <i class="bi bi-check"></i>
  </button>
  
  <button class="btn btn-sm btn-outline-danger" (click)="rejectDocument(document)" 
          *ngIf="document.status === 'PENDING_APPROVAL' && isAdmin" title="Rejeter">
    <i class="bi bi-x"></i>
  </button>
  
  <!-- Archive/Restore -->
  <button class="btn btn-sm btn-outline-warning" (click)="archiveDocument(document)" 
          *ngIf="document.status === 'ACTIVE'" title="Archiver">
    <i class="bi bi-archive"></i>
  </button>
  
  <button class="btn btn-sm btn-outline-warning" (click)="restoreDocument(document)" 
          *ngIf="document.status === 'ARCHIVED'" title="Restaurer">
    <i class="bi bi-arrow-counterclockwise"></i>
  </button>
  
  <!-- Suppression -->
  <button class="btn btn-sm btn-outline-danger" (click)="deleteDocument(document)" 
          *ngIf="document.status !== 'ACTIVE' || isAdmin" title="Supprimer">
    <i class="bi bi-trash"></i>
  </button>
</div>
        </div>
    </div>

    <!-- Pagination -->
    <div class="pagination-container">
        <div class="showing-info">
            Showing {{(currentPage - 1) * itemsPerPage + 1}} - {{Math.min(currentPage * itemsPerPage, totalItems)}} of
            {{totalItems}} items
        </div>
        <nav aria-label="Page navigation">
            <ul class="pagination">
                <li class="page-item" [class.disabled]="currentPage === 1">
                    <a class="page-link" href="javascript:void(0)" (click)="onPageChange(1)" aria-label="First">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
                <li class="page-item" [class.disabled]="currentPage === 1">
                    <a class="page-link" href="javascript:void(0)" (click)="onPageChange(currentPage - 1)"
                        aria-label="Previous">
                        <span aria-hidden="true">&lt;</span>
                    </a>
                </li>

                <ng-container
                    *ngFor="let page of [].constructor(Math.min(5, Math.ceil(totalItems / itemsPerPage))); let i = index">
                    <li class="page-item" [class.active]="currentPage === i + 1">
                        <a class="page-link" href="javascript:void(0)" (click)="onPageChange(i + 1)">{{i + 1}}</a>
                    </li>
                </ng-container>

                <li class="page-item" [class.disabled]="currentPage === Math.ceil(totalItems / itemsPerPage)">
                    <a class="page-link" href="javascript:void(0)" (click)="onPageChange(currentPage + 1)"
                        aria-label="Next">
                        <span aria-hidden="true">&gt;</span>
                    </a>
                </li>
                <li class="page-item" [class.disabled]="currentPage === Math.ceil(totalItems / itemsPerPage)">
                    <a class="page-link" href="javascript:void(0)"
                        (click)="onPageChange(Math.ceil(totalItems / itemsPerPage))" aria-label="Last">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>

    <!-- Modal pour l'upload de document -->
    <div class="modal fade" id="uploadDocumentModal" tabindex="-1" aria-labelledby="uploadDocumentModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="uploadDocumentModalLabel">Importer un document</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form [formGroup]="uploadForm">
                        <div class="mb-3">
                            <label for="documentFile" class="form-label">Fichier</label>
                            <input type="file" class="form-control" id="documentFile" (change)="onFileSelected($event)">
                            <div class="form-text">Types de fichiers acceptés: PDF, DOCX, XLSX, PPTX, etc. (max 10MB)
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="title" class="form-label">Titre</label>
                            <input type="text" class="form-control" id="title" formControlName="title">
                        </div>
                        <div class="mb-3">
                            <label for="description" class="form-label">Description</label>
                            <textarea class="form-control" id="description" rows="3"
                                formControlName="description"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="keywords" class="form-label">Mots-clés</label>
                            <input type="text" class="form-control" id="keywords" formControlName="keywords"
                                placeholder="Séparez les mots-clés par des virgules">
                            <div class="form-text">Exemple: rapport, finances, 2023</div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <button type="button" class="btn btn-primary" [disabled]="isUploading" (click)="uploadDocument()">
                        <i class="bi bi-upload"></i> Importer
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>