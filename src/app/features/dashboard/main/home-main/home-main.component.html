<div class="main-content">
  <!-- Header with greeting and search -->
  <div class="header">
    <h1>Bonjour, {{username}} !</h1>
    <div class="search-bar" [class.expanded]="isSearchExpanded" (click)="toggleSearch()">
      <svg *ngIf="!isSearchExpanded" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/>
      </svg>
      <input *ngIf="isSearchExpanded" type="text" placeholder="Rechercher..." (keyup)="search($event)" autofocus>
      <svg *ngIf="isSearchExpanded" (click)="closeSearch($event)" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-lg" viewBox="0 0 16 16">
        <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
      </svg>
    </div>
  </div>
  
  <!-- Content Wrapper with Scroll -->
  <div class="content-wrapper">
    <!-- Info Cards -->
    <div class="info-cards">
      <div class="card fade-in" style="animation-delay: 0.1s">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-card-image card-icon" viewBox="0 0 16 16">
          <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"/>
          <path d="M1.5 2A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2zm13 1a.5.5 0 0 1 .5.5v6l-3.775-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12v.54L1 12.5v-9a.5.5 0 0 1 .5-.5z"/>
        </svg>
        <div class="card-count">{{cardData.images.count || 0}}</div>
        <div class="card-label">{{cardData.images.label || 'Images'}}</div>
      </div>
      
      <div class="card fade-in" style="animation-delay: 0.2s">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-camera-video card-icon" viewBox="0 0 16 16">
          <path fill-rule="evenodd" d="M0 5a2 2 0 0 1 2-2h7.5a2 2 0 0 1 1.983 1.738l3.11-1.382A1 1 0 0 1 16 4.269v7.462a1 1 0 0 1-1.406.913l-3.111-1.382A2 2 0 0 1 9.5 13H2a2 2 0 0 1-2-2zm11.5 5.175 3.5 1.556V4.269l-3.5 1.556zM2 4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h7.5a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1z"/>
        </svg>
        <div class="card-count">{{cardData.videos.count || 0}}</div>
        <div class="card-label">{{cardData.videos.label || 'Vidéos'}}</div>
      </div>
      
      <div class="card fade-in" style="animation-delay: 0.3s">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-box card-icon" viewBox="0 0 16 16">
          <path d="M8.186 1.113a.5.5 0 0 0-.372 0L1.846 3.5 8 5.961 14.154 3.5zM15 4.239l-6.5 2.6v7.922l6.5-2.6V4.24zM7.5 14.762V6.838L1 4.239v7.923l6.5 2.6zM7.443.184a1.5 1.5 0 0 1 1.114 0l7.129 2.852A.5.5 0 0 1 16 3.5v8.662a1 1 0 0 1-.629.928l-7.185 2.874a.5.5 0 0 1-.372 0L.63 13.09a1 1 0 0 1-.63-.928V3.5a.5.5 0 0 1 .314-.464L7.443.184z"/>
        </svg>
        <div class="card-count">{{cardData.picto.count || 0}}</div>
        <div class="card-label">{{cardData.picto.label || 'Pictos'}}</div>
      </div>
      
      <div class="card fade-in" style="animation-delay: 0.4s">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-file-earmark-font card-icon" viewBox="0 0 16 16">
          <path d="M10.943 6H5.057L5 8h.5c.18-1.096.356-1.192 1.694-1.235l.293-.01v5.09c0 .47-.1.582-.898.655v.5H9.41v-.5c-.803-.073-.903-.184-.903-.654V6.755l.298.01c1.338.043 1.514.14 1.694 1.235h.5l-.057-2z"/>
          <path d="M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5zm-3 0A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5z"/>
        </svg>
        <div class="card-count">{{cardData.documents.count || 0}}</div>
        <div class="card-label">{{cardData.documents.label || 'Documents'}}</div>
      </div>
    </div>
    
    <!-- Dashboard Charts -->
    <div class="dashboard-charts fade-in" style="animation-delay: 0.5s">
      <!-- File Status Chart -->
      <div class="chart-card">
        <div class="chart-header">
          <h2>État des fichiers</h2>
          <p class="chart-subheader">Images, vidéos et campagnes</p>
        </div>
        
        <div class="chart-content">
          <!-- Circle Chart -->
          <div class="donut-chart">
            <svg viewBox="0 0 100 100" class="donut">
              <!-- Base circle -->
              <circle cx="50" cy="50" r="40" fill="transparent" stroke="#eee" stroke-width="20"></circle>
              
              <!-- Dynamic segments -->
              <ng-container *ngIf="chartData && chartData.length">
                <circle *ngFor="let item of chartData; let i = index" 
                       cx="50" cy="50" r="40" fill="transparent"
                       [attr.stroke]="item.color"
                       stroke-width="20"
                       [attr.stroke-dasharray]="getDonutSegment(item.count, i)"
                       [attr.stroke-dashoffset]="getDonutOffset(i)">
                </circle>
              </ng-container>
              
              <!-- No data fallback -->
              <circle *ngIf="!chartData || !chartData.length"
                     cx="50" cy="50" r="40" fill="transparent"
                     stroke="#cbd5e1"
                     stroke-width="20"
                     stroke-dasharray="251.2"
                     stroke-dashoffset="0">
              </circle>
            </svg>
          </div>
          
          <!-- Chart Legend -->
          <div class="chart-legend">
            <ng-container *ngIf="chartData && chartData.length">
              <div class="legend-item" *ngFor="let item of chartData">
                <div class="legend-color" [style.background-color]="item.color"></div>
                <div class="legend-label">{{item.status}}</div>
                <div class="legend-count">
                  <span class="count-number">{{item.count}}</span>
                  <span class="count-percent">({{getPercentage(item.count)}})</span>
                </div>
              </div>
            </ng-container>
            
            <!-- No data fallback -->
            <div class="legend-item" *ngIf="!chartData || !chartData.length">
              <div class="legend-color" style="background-color: #cbd5e1"></div>
              <div class="legend-label">Aucune donnée</div>
              <div class="legend-count">0</div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- File Management Illustration -->
      <div class="illustration-card">
        <img src="./assets/images/dash.png" alt="Gestion de fichiers" class="illustration-image">
      </div>
    </div>
    
    <!-- Recent Activity Section -->
    <div class="recent-activity fade-in" style="animation-delay: 0.6s" *ngIf="recentActivities && recentActivities.length">
      <div class="activity-header">
        <h2>Activités récentes</h2>
        <a href="#" class="view-all">
          Voir tout
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-right" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z"/>
          </svg>
        </a>
      </div>
      
      <div class="activity-list">
        <div class="activity-item" *ngFor="let activity of recentActivities">
          <div class="activity-icon" [ngClass]="activity.type">
            <svg *ngIf="activity.type === 'upload'" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cloud-upload" viewBox="0 0 16 16">
              <path fill-rule="evenodd" d="M4.406 1.342A5.53 5.53 0 0 1 8 0c2.69 0 4.923 2 5.166 4.579C14.758 4.804 16 6.137 16 7.773 16 9.569 14.502 11 12.687 11H10a.5.5 0 0 1 0-1h2.688C13.979 10 15 8.988 15 7.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 2.825 10.328 1 8 1a4.53 4.53 0 0 0-2.941 1.1c-.757.652-1.153 1.438-1.153 2.055v.448l-.445.049C2.064 4.805 1 5.952 1 7.318 1 8.785 2.23 10 3.781 10H6a.5.5 0 0 1 0 1H3.781C1.708 11 0 9.366 0 7.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383z"/>
              <path fill-rule="evenodd" d="M7.646 4.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 5.707V14.5a.5.5 0 0 1-1 0V5.707L5.354 7.854a.5.5 0 1 1-.708-.708l3-3z"/>
            </svg>
            <svg *ngIf="activity.type === 'edit'" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">
              <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
              <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
            </svg>
            <svg *ngIf="activity.type === 'delete'" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
              <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
              <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
            </svg>
            <svg *ngIf="activity.type === 'view'" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye" viewBox="0 0 16 16">
              <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"/>
              <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"/>
            </svg>
          </div>
          
          <div class="activity-content">
            <div class="activity-title">{{activity.title}}</div>
            <div class="activity-detail">{{activity.detail}}</div>
          </div>
          
          <div class="activity-time">{{activity.time}}</div>
        </div>
      </div>
    </div>
    
    <!-- No Recent Activity State -->
    <div class="no-data fade-in" style="animation-delay: 0.6s" *ngIf="!recentActivities || !recentActivities.length">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clock-history" viewBox="0 0 16 16">
        <path d="M8.515 1.019A7 7 0 0 0 8 1V0a8 8 0 0 1 .589.022l-.074.997zm2.004.45a7.003 7.003 0 0 0-.985-.299l.219-.976c.383.086.76.2 1.126.342l-.36.933zm1.37.71a7.01 7.01 0 0 0-.439-.27l.493-.87a8.025 8.025 0 0 1 .979.654l-.615.789a6.996 6.996 0 0 0-.418-.302zm1.834 1.79a6.99 6.99 0 0 0-.653-.796l.724-.69c.27.285.52.59.747.91l-.818.576zm.744 1.352a7.08 7.08 0 0 0-.214-.468l.893-.45a7.976 7.976 0 0 1 .45 1.088l-.95.313a7.023 7.023 0 0 0-.179-.483zm.53 2.507a6.991 6.991 0 0 0-.1-1.025l.985-.17c.067.386.106.778.116 1.17l-1 .025zm-.131 1.538c.033-.17.06-.339.081-.51l.993.123a7.957 7.957 0 0 1-.23 1.155l-.964-.267c.046-.165.086-.332.12-.501zm-.952 2.379c.184-.29.346-.594.486-.908l.914.405c-.16.36-.345.706-.555 1.038l-.845-.535zm-.964 1.205c.122-.122.239-.248.35-.378l.758.653a8.073 8.073 0 0 1-.401.432l-.707-.707z"/>
        <path d="M8 1a7 7 0 1 0 4.95 11.95l.707.707A8.001 8.001 0 1 1 8 0v1z"/>
        <path d="M7.5 3a.5.5 0 0 1 .5.5v5.21l3.248 1.856a.5.5 0 0 1-.496.868l-3.5-2A.5.5 0 0 1 7 9V3.5a.5.5 0 0 1 .5-.5z"/>
      </svg>
      <div class="no-data-title">Aucune activité récente</div>
      <div class="no-data-message">Vos activités récentes apparaîtront ici lorsque vous commencerez à utiliser la plateforme.</div>
      <button class="no-data-action" routerLink="/dashboard/librairie/web/images">Commencer maintenant</button>
    </div>
  </div>
</div>